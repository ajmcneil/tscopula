---
title: "D-Vine and VT-D-Vine Copula Processes of First Kind"
author: "Alexander J. McNeil and Martin Bladt"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{D-Vine and VT-D-Vine Copula Processes of First Kind}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(tscopula)
```

## D-Vine Copula Processes

### Construction

We construct a copula of order $p = 4$ in which the copulas are respectively Gauss, Frank, Clayton and Student t. The parameters are given in a list. Individual copulas can be rotated through 180 degrees.

```{r}
copmod <- dvinecopula(
  family = c("Clayton","t", "Frank", "Gaussian"),
  pars = list(1.2, c(0.4,5), 2, 0.15),
  rotation = c(180,0, 0,0)
)
copmod
```

### Simulation

A realization can be generated with the generic command `sim`.

```{r, fig.show='hold', fig.width = 6, fig.height = 3, dev.args =list(pointsize=9)}
set.seed(29)
data1 <- sim(copmod, n = 2000)
hist(data1)
ts.plot(data1)
```

### Estimation 

A model spec can be fitted to data with the generic command `fit`.

```{r}
copspec <- dvinecopula(
  family = c("Clayton","t", "Frank", "Gaussian"),
  pars = list(0.5, c(0,10), 1, 0),
  rotation = c(180, 0, 0, 0)
)
copfit <- fit(copspec, data1, tsoptions = list(hessian = TRUE))
copfit
coef(copfit)
coef(copmod)
```

### Plotting

Various plots are generated by the generic command `plot`. 

```{r, fig.show='hold', dev.args =list(pointsize=9)}
plot(copfit)
plot(copfit, plottype = "kendall")
```

Here is the generalized lag plot.

```{r, fig.show='hold', fig.width = 6, fig.height = 6, dev.args =list(pointsize=9)}
plot(copfit, plottype = "glag")
```

## VT-D-Vine Copula Processes

VT-D-Vine processes are created by adding a v-transform to an `dvinecopula` object using the command `vtscopula`. The generic commands `sim`, `fit` and `plot` also work for these processes.

### Construction

We add a 2-parameter V-transform.

```{r}
vcopmod <- vtscopula(copmod,
  Vtransform = V2p(delta = 0.55, kappa = 1.2)
)
vcopmod
```

### Simulation

```{r, fig.show='hold', fig.width = 6, fig.height = 3, dev.args =list(pointsize=9)}
set.seed(19)
data2 <- sim(vcopmod, n = 2000)
hist(data2)
ts.plot(data2)
```

### Estimation

```{r}
vcopspec <- vtscopula(copspec, V2p())
vcopfit <- fit(vcopspec, data2, 
               tsoptions = list(hessian = TRUE),
               control = list(maxit = 3000))
vcopfit
coef(vcopfit)
coef(vcopmod)
```

### Plotting

We can plot the estimated v-transform and well as the goodness-of-fit plots for the `dvinecopula` object based on Kendall rank correlations.

```{r, fig.show='hold', fig.width = 6, fig.height = 3, dev.args =list(pointsize=9)}
plot(vcopfit, plottype = "residual")
plot(vcopfit, plottype = "vtransform")
plot(vcopfit, plottype = "kendall")
```

### Resimulation of fitted model

Note that we can easily simulate data from the fitted model using the following code.

```{r}
data2b <- sim(vcopfit, 2000)
ts.plot(data2b)
```


