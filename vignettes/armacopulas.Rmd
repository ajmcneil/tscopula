---
title: "ARMA and VT-ARMA Copula Processes"
author: "Alexander J. McNeil and Martin Bladt"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ARMA and VT-ARMA Copula Processes}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(tscopula)
```

## ARMA Copula Processes

### AR(1) Example
An ARMA copula is specified by a list of two vectors, the first named `ar` and the second `ma`. The following example creates an AR(1) copula process specification and then displays the spec.

```{r}
ar1 <- armacopula(list(ar = 0.7))
ar1
```

A realization can be generated with the generic command `sim`.

```{r, fig.show='hold', fig.width = 6, fig.height = 3, dev.args =list(pointsize=9)}
set.seed(13)
data1 <- sim(ar1, 1000)
ts.plot(data1)
```

A model spec can be fitted to data with the generic command `fit`.

```{r}
ar1spec <- armacopula(list(ar = 0))
ar1fit <- fit(ar1spec, data1)
ar1fit
```

### ARMA(1,1) Example

The next example simulates and fits an ARMA(1,1) copula process, giving standard errors for the parameter estimates.

```{r, fig.show='hold', fig.width = 6, fig.height = 3, dev.args =list(pointsize=9)}
arma11 <- armacopula(list(ar = 0.95, ma = -0.85))
data2 <- sim(arma11, 1000)
ts.plot(data2)

arma11spec <- armacopula(list(ar = 0.1, ma = 0.1))
arma11fit <- fit(arma11spec, data2, tsoptions = list(hessian = TRUE))
arma11fit
```

Coefficients of the fitted model are obtained with the command `coef`, residuals with the command `resid` and various plots are generated by the generic command `plot`. 

```{r, fig.show='hold'}
coef(arma11fit)
res <- resid(arma11fit)
acf(res)
acf(abs(res))
plot(arma11fit)
plot(arma11fit, plottype = "kendall")
mu_t <- resid(arma11fit, trace = TRUE)
ts.plot(mu_t)
```

The data for these plots comes from applying the Kalman filter command `kfilter`.
```{r}
head(kfilter(arma11fit@tscopula, data2))
```

## VT-ARMA Copula Processes

Vt-ARMA processes are created by adding a v-transform to an armacopula process using the command `vtscopula`. The generic commands `sim`, `fit` and `plot` also work for these processes.

### VT-AR(1) Example

We first look at a simple symmetric process.

```{r, fig.show='hold', fig.width = 6, fig.height = 3, dev.args =list(pointsize=9)}
vtar1 <- vtscopula(armacopula(list(ar = 0.7)), Vtransform = Vlinear(0.5))
set.seed(19)
data3 <- sim(vtar1, 2000)
ts.plot(data3)

vtar1spec <- vtscopula(ar1spec, Vtransform = Vlinear())
vtar1fit <- fit(vtar1spec, data3)
vtar1fit
```

### VT-ARMA(1,1) Examples

This example uses a ARMA(1,1) copula and an off-centre linear v-transform.

```{r, fig.show='hold', dev.args =list(pointsize=9)}
vtarma11 <- vtscopula(armacopula(list(ar = 0.95, ma = -0.85)),
  Vtransform = Vlinear(delta = 0.55))
set.seed(19)
data4 <- sim(vtarma11, 2000)
ts.plot(data4)

vtarma11spec <- vtscopula(arma11spec, Vtransform = Vlinear())
vtarma11fit <- fit(vtarma11spec, data4)
vtarma11fit

plot(vtarma11fit)
plot(vtarma11fit, plottype = "vtransform")
plot(vtarma11fit, plottype = "kendall" )
```

This example uses an ARMA(1,1) process and a 2-parameter v-transform.

```{r}
vt2arma11 <- vtscopula(armacopula(list(ar = 0.95, ma = -0.85)),
  Vtransform = V2p(delta = 0.55, kappa = 0.8))
set.seed(17)
data5 <- sim(vt2arma11, n = 5000)

vt2arma11spec <- vtscopula(arma11spec, Vtransform = V2p())
vt2arma11fit <- fit(vt2arma11spec, data5)
vt2arma11fit
```

Note that we can easily simulate data from the fitted model using the following code.

```{r}
data5b <- sim(vt2arma11fit, 1000)
ts.plot(data5b)
```

For this model we plot a profile likelihood plot using different fixed values for the fulcrum parameter $\delta$ of a linear v-transform. The base copula is the copula of the `vt2arma11spec`.

```{r, fig.show='hold', dev.args =list(pointsize=9)}
profilefulcrum(data5, tscopula = vt2arma11spec, locations = seq(from = 0, to = 1, length = 21))
abline(v = 0.55)
```

